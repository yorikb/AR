<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindAR.js - Переміщення моделі з мітки</title>
    <script src="https://cdn.jsdelivr.net/npm/mindar@1.2.3/dist/mindar-image.prod.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.152.2/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.152.2/examples/jsm/loaders/GLTFLoader.js"></script>
    <style>
        body { margin: 0; }
        canvas { display: block; }
    </style>
</head>
<body>
    <div style="position: relative;">
        <canvas id="sceneCanvas" width="800" height="600"></canvas>
        <div id="loading" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">Завантаження...</div>
    </div>

    <script>
        import { MindARThree } from 'mindar-image-three';

        document.addEventListener('DOMContentLoaded', () => {
          
            const sceneCanvas = document.getElementById('sceneCanvas');
            const loadingElement = document.getElementById('loading');

            let mindarThree = null;
            let model = null;
            let anchor = null;
            
            const start = async () => {
                mindarThree = new MindARThree({
                    container: sceneCanvas,
                    imageTargetSrc: 'marker.mind', // Замініть на шлях до вашого файлу .mind
                });

                const { renderer, scene, camera } = mindarThree;

                const geometry = new THREE.BoxGeometry(0.2, 0.2, 0.2);
                const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
                // model = new THREE.Mesh(geometry, material); // Простий куб як заповнювач

                // Завантаження GLTF моделі (замініть шлях на свій)
                
                console.error( 'loading' );

                const loader = new THREE.GLTFLoader();
                loader.load('https://yorikb.github.io/AR/DamagedHelmet.glb', (gltf) => {
                    model = gltf.scene;
                    model.scale.set(0.1, 0.1, 0.1); // Налаштуйте масштаб моделі
                }, undefined, (error) => {
                    console.error('An error happened loading the model', error);
                });

                anchor = mindarThree.addAnchor(0); // Індекс цілі, зазвичай 0 для першої цілі

                anchor.onTargetFound = () => {
                    console.log('Ціль знайдено');
                    if (model) {
                        anchor.group.add(model);
                    }
                }

                anchor.onTargetLost = () => {
                    console.log('Ціль втрачено');
                    if (model && anchor.group.children.includes(model)) {
                        anchor.group.remove(model);
                        scene.add(model); // Додаємо модель безпосередньо до сцени, зберігаючи її останнє положення
                    }
                }

                await mindarThree.start();
                loadingElement.style.display = 'none';

                renderer.setAnimationLoop(() => {
                    renderer.render(scene, camera);
                });
            }

            start();
        });
    </script>
</body>
</html>